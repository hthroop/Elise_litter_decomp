Litter170424 <- Litter170424 %>%
  filter(Litter_substrate == "Shrub")

library(dplyr)

# Subset data where Litter_substrate is "Shrub"
shrub_data <- Litter170424 %>%
  filter(Litter_substrate == "Shrub")

# Plotting
pd <- position_dodge(0.1)  # Adjust as needed


# Perform linear regression separately

regression_lines <- lm(Ash_free_mass_remaining ~ pct_ash + microsite + Month, data = shrub_data)

# Calculate R-squared value
r_squared <- summary(regression_lines)$r.squared

# Print the R-squared value
print(r_squared)

# Filter out non-finite values in pct_ash
shrub_data_filtered <- shrub_data[is.finite(shrub_data$pct_ash), ]

# Extract regression line data
regression_data <- data.frame(
  pct_ash = rep(seq(min(shrub_data_filtered$pct_ash), max(shrub_data_filtered$pct_ash), length.out = 100), times = 8),
  microsite = rep(rep(unique(shrub_data_filtered$microsite), each = 100), times = 4),
  Month = rep(rep(unique(shrub_data_filtered$Month), each = 100), times = 2)
)

# Predict values using the linear model
regression_data$Ash_free_mass_remaining <- predict(regression_lines, newdata = regression_data)

# Define shapes for months
month_shapes <- c(16, 18, 15, 17, 20, 21, 22)


# Define colors for microsites
microsite_colors <- c("blue", "brown")

# Define colors for regression lines (different from microsite colors)
regression_line_colors <- c("red", "blue", "green", "purple", "orange", "brown", "pink", "black")

# Plotting
p <- ggplot(shrub_data_filtered, aes(x = pct_ash, y = Ash_free_mass_remaining, color = factor(microsite), shape = factor(Month))) +
  geom_point(position = pd, size = 3) +
  geom_smooth(data = filter(shrub_data_filtered, !duplicated(Month)), 
              method = "lm", se = FALSE, aes(group = Month), 
              size = 1, linetype = "solid", color = regression_line_colors) +
  labs(x = "In(% ash)", y = "ln(% mass remaining)", title = "Linear Regression (Shrub Data)") +
  theme_classic() +
  scale_color_manual(values = microsite_colors) +
  scale_shape_manual(values = month_shapes) +
  scale_y_continuous(breaks = seq(0, ceiling(max(shrub_data_filtered$Ash_free_mass_remaining, na.rm = TRUE)), by = 0.5),
                     labels = seq(0, ceiling(max(shrub_data_filtered$Ash_free_mass_remaining, na.rm = TRUE)), by = 0.5)) +
  theme(axis.text.x = element_text(hjust = 1, color = "black", size = 11, vjust = 1),
        axis.text.y = element_text(angle = 0, color = "black", size = 11, hjust = 1, vjust = 1))

# Display the plot
print(p)

# Add regression lines with different linetypes for each month
p + 
  geom_smooth(method = "lm", se = FALSE, aes(group = Month, linetype = as.factor(Month)), size = 1, color = "black") +
  scale_linetype_manual(values = c("solid", "dashed", "dotted", "dotdash", "longdash", "twodash"))  # Add more linetypes as needed
